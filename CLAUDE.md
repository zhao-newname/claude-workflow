# 项目开发规范

<!-- CW_PRESET_START -->
<!-- Version: 1.2.0 -->
<!--
  ⚠️ 注意：此部分为 Claude Workflow 预设规范
  - 标记之间的内容由 cw init 自动管理
  - 如需自定义规范，请在下方"项目自定义规范"部分添加
  - 修改此部分内容后，再次执行 cw init 可能会被覆盖
-->

## 🔄 任务恢复协议

### 触发词识别

当用户说以下内容时，立即启动任务恢复流程：
- "继续上次的工作" / "继续" / "继续工作"
- "resume" / "恢复工作" / "恢复"
- "接着做" / "从哪里开始？"
- "读取文档" / "查看任务" / "读取任务"

### 可视化执行流程

**重要**：执行任务恢复时，必须输出清晰的步骤说明，让用户看到执行过程。

**标准输出格式**：
```
🔍 检测到任务恢复请求，开始加载...

📂 读取 .claude/ACTIVE_TASK.md...
   ✅ 找到活跃任务: [任务名称]

📋 读取任务上下文 ([任务名]-context.md)...
   ✅ 已加载上下文信息

📝 读取任务清单 ([任务名]-tasks.md)...
   ✅ 已加载任务清单

📊 任务状态：
   - 完成度: XX%
   - 上次更新: YYYY-MM-DD
   - 当前进度: [简要说明]

✨ 准备就绪，继续工作...
```

### 执行步骤

1. **输出开始提示** - 告诉用户正在加载任务
   ```
   🔍 检测到任务恢复请求，开始加载...
   ```

2. **读取 ACTIVE_TASK.md** - 读取 `.claude/ACTIVE_TASK.md`
   ```
   📂 读取 .claude/ACTIVE_TASK.md...
   ```
   - 如果文件不存在，提示用户没有活跃任务
   - 如果文件存在，从中提取任务名称和文件路径

3. **读取 context.md** - 根据 ACTIVE_TASK.md 中的路径读取上下文文件
   ```
   📋 读取任务上下文 (dev/active/[任务名]/[任务名]-context.md)...
   ```
   - 使用完整的文件路径
   - 例如：`dev/active/dev-docs-optimization/dev-docs-optimization-context.md`

4. **读取 tasks.md** - 根据 ACTIVE_TASK.md 中的路径读取任务清单
   ```
   📝 读取任务清单 (dev/active/[任务名]/[任务名]-tasks.md)...
   ```
   - 使用完整的文件路径
   - 例如：`dev/active/dev-docs-optimization/dev-docs-optimization-tasks.md`

5. **总结状态** - 显示任务进度和下一步
   ```
   📊 任务状态：
      - 完成度: XX%
      - 上次更新: YYYY-MM-DD
      - 当前进度: [简要说明]
   ```

6. **开始工作** - 根据上下文继续任务
   ```
   ✨ 准备就绪，继续工作...
   ```

**关键**：
- 每个步骤都要有可视化输出，使用 emoji 和清晰的格式
- 使用 Read 工具时必须提供完整的文件路径
- 先读取 ACTIVE_TASK.md 获取任务信息，再读取其他文件

---

## Claude Workflow 预设规范

1. **方案先行**: 在编写任何代码之前,请先描述你的方案并等待批准。如果需求不明确,在编写任何代码之前务必提出澄清问题。

2. **任务分解**: 如果一项任务需要修改超过 3 个文件,请先停下来,将其分解成更小的任务。

3. **测试驱动**: 编写代码后,列出可能出现的问题,并建议相应的测试用例来覆盖这些问题。

4. **Bug 修复流程**: 当发现 bug 时,首先要编写一个能够重现该 bug 的测试,然后不断修复它,直到测试通过为止。

5. **持续改进**: 每次我纠正你之后,就在 CLAUDE.md 文件中添加一条新规则,这样就不会再发生这种情况了。

6. **可行性**: 你每次都必须使用英文思考，但是要以中文回答用户。

---

## 🎯 CW 项目核心定位（重要）

### CW 是什么？

**Claude Workflow (cw)** 是一个 **CLI 配置管理工具**，不是运行时工具。

### CW 的职责边界

**CW 负责（配置和管理）：**
- ✅ 初始化项目配置 (`cw init`)
- ✅ 管理技能库 (`cw skills install/list`)
- ✅ 管理开发文档 (`cw tasks`)
- ✅ 验证配置 (`cw triggers validate`)
- ✅ 提供 CLI 辅助工具 (`cw triggers test`)

**CW 不负责（运行时逻辑）：**
- ❌ 运行时的技能激活（由 `.claude/hooks/` 负责）
- ❌ 文件触发检测（由 hooks 负责）
- ❌ 与 Claude 的交互（由 Claude Code 负责）
- ❌ 提供运行时 API（hooks 是独立脚本）

### 关键原则

1. **配置与运行时分离**
   - CW 生成配置文件（`.claude/` 目录）
   - Hooks 在运行时读取配置并执行
   - CW 的 TypeScript 模块不被 hooks 调用

2. **技能是知识，不是逻辑**
   - 技能（SKILL.md）提供领域知识和最佳实践
   - 技能不应包含复杂的运行时逻辑
   - 运行时逻辑应该在 hooks 中实现

3. **通用性优先**
   - CW 是通用工具，适用于任何项目
   - 不假设特定技术栈或项目结构
   - 项目特定配置通过 `skill-rules.json` 定义

### 架构示意

```
CW (CLI 工具)
  ↓ 生成配置
.claude/
  ├── settings.json       (Claude Code 配置)
  ├── skills/             (技能库)
  │   └── skill-rules.json (触发规则)
  └── hooks/              (运行时脚本)
      ├── skill-activation-prompt.ts
      └── post-tool-use-tracker.sh
  ↓ 运行时
Claude Code 读取配置，执行 hooks
```

**记住**：当考虑添加新功能时，先问自己：这是配置管理（CW）还是运行时逻辑（hooks）？

<!-- CW_PRESET_END -->

## 项目自定义规范

（在这里添加项目特定的开发规范）
